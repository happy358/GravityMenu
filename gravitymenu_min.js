/*!
 * gravityMenu.js v1.0.0
 * Copyright(c)2020 happy358
 * Site:https://labs.manohara.info/gravitymenu/
 * Released under the MIT license.
 * see https://github.com/happy358/GravityMenu/blob/master/LICENSE
 */
const garavityMenu=function(param){let e,t,o,n,r,i,a=Matter.Engine,l=Matter.Render,s=Matter.Runner,c=Matter.Common,d=Matter.Events,u=Matter.MouseConstraint,m=Matter.Mouse,f=Matter.Query,g=Matter.World,p=Matter.Body;Bodies=Matter.Bodies;const w=param.canvas||"canvas",y=document.querySelector(w),h=param.menu_list||"",v=param.menu_imageSize||"500",_=h.length,M=param.social||!1,x=param.social_size||40,S=param.social_list||"",E=S.length,z=param.social_imageSize||"500",b=x/z;let B,T,A,I,W,C,L,k,H,R;try{if(!h)throw new Error("garavityMenu:menu_list parametar is empty!");if(M&&!S)throw new Error("garavityMenu:social_list parametar is empty!")}catch(e){console.log(e.message)}let U,V=[],q=[];function D(){if(drag_flag=!1,L=!1,k=param.size||50,H=.5*k*1.5,R=param.gap||0,T=window.innerWidth,A=window.innerHeight,k=(I=A>T)?Math.round(T/(1.2*_)):k,(W=k*_+R*(_-1))>T){let e=T/W;W=(k*=e)*_+(R*=e)*(_-1)}C=(T-W)/2+.5*k,H=I?.5*k*1.5:H,B=k/v,t=a.create(),world=t.world,t.world.gravity.y=.8,e=l.create({canvas:y,engine:t,options:{width:T,height:A,background:"transparent",wireframes:!1,showInternalEdges:!0,showShadows:!1}}),l.run(e),o=s.create(),s.run(o,t);const n={friction:0,isStatic:!0};g.add(world,[Bodies.rectangle(T/2,-250,2*T,500,n),Bodies.rectangle(T/2,A+250,2*T,500,n),Bodies.rectangle(T+250,A/2,500,2*A,n),Bodies.rectangle(-250,A/2,500,2*A,n)]);let w;V=[];for(let e=0;e<_;e++){w={frictionAir:0,friction:0,restitution:.88,frictionStatic:.5,isStatic:!0,label:"menu_"+e,render:{lineWidth:0,sprite:{texture:h[e][2],xScale:B,yScale:B},cursor:"pointer"}};let t=P(e,"M");V[e]=Bodies.circle(t.x,t.y,.5*k,w),setTimeout(Q,c.random(2500,3e3),V[e])}g.add(world,V),setTimeout(j,7e3),U=setTimeout(F,18e3),r=m.create(e.canvas),i=u.create(t,{mouse:r,constraint:{stiffness:.2,render:{visible:!1}}}),g.add(world,i),e.mouse=r,d.on(i,"startdrag",function(e){L=!0,drag_flag=!0}),d.on(i,"mousedown",function(e){L=!1,drag_flag=!0}),d.on(i,"mousemove",function(e){L=!0;let t=!1,o=f.point(V,e.mouse.position);o[0]&&void 0!=o[0]&&(t=!0),M&&(o=f.point(q,e.mouse.position))[0]&&void 0!=o[0]&&(t=!0),t||drag_flag?(y.style.cursor="pointer",y.style.zIndex=9):(y.style.cursor="auto",y.style.zIndex=0)}),d.on(i,"mouseup",function(e){y.style.cursor="auto",y.style.zIndex=0,L=!1,drag_flag=!1,i.body=null}),d.on(i,"enddrag",function(e){if(y.style.cursor="auto",y.style.zIndex=0,drag_flag=!1,!L){let t=e.body.label;if("menu_"==t.slice(0,5)){let e=t.slice(5);M&&"social"==h[e][0]?(clearTimeout(U),q&&q.length?(g.remove(world,q),q=[]):F()):h[e][1]&&location.replace(h[e][1])}else if(M&&"social_"==t.slice(0,7)){let e=t.slice(7),o=S[e][0];if(S[e][1]&&confirm("Share on "+o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()+"?"))return!window.open(S[e][1],"_blank")&&(window.location.href=S[e][1],!1)}}L=!1}),d.on(t,"beforeUpdate",function(e){for(let e=0;e<V.length;e++)p.setAngularVelocity(V[e],0);if(M)for(let e=0;e<q.length;e++)p.setAngularVelocity(q[e],0)})}function P(e,t){let o=[];return o.x=o.y=0,"M"==t&&(o.x=k*e+R*e+C),o.y=H,o}function Q(e){p.setStatic(e,!1)}function j(){t.world.gravity.y=-1.3}function F(){if(M){for(let e=0;e<E;e++)cirlce_option={frictionAir:0,friction:.001,restitution:.78,isStatic:!1,label:"social_"+e,render:{lineWidth:0,sprite:{texture:S[e][2],xScale:b,yScale:b}}},q[e]=Bodies.circle(T/2,A,.5*x,cirlce_option);g.add(world,q)}}function G(e){y.style.cursor="auto",y.style.zIndex=0,drag_flag=!1;let t=document.createEvent("MouseEvents");t.initEvent("mouseup",!1,!0),y.dispatchEvent(t)}D(),y.addEventListener("mouseleave",G,!1),y.addEventListener("touchleave",G,!1);let J=null,K=T,N=A;window.addEventListener("resize",function(n){n.preventDefault(),n.stopPropagation(),clearTimeout(U),clearTimeout(J),J=setTimeout(function(){let n=window.innerWidth,r=window.innerHeight;K===n&&N===r||(g.clear(world),a.clear(t),l.stop(e),s.stop(o),e.canvas=null,e.context=null,e.textures={},D(),K=n,N=r)},300)},!1),l.lookAt(e,{min:{x:0,y:0},max:{x:T,y:A}});};
